<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .live-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%;
        overflow: hidden;
        position: relative;
      }
      @media screen and (orientation: landscape) {
        .live-container {
          padding-bottom: 0;
          height: 100vh;
        }
      }
      .live-content {
        position: absolute;
        width: 100%;
        height: 100%;
      }
      body {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
    </style>
    <script src="../plugin/pixi.js"></script>
    <script src="../js/util.js"></script>
  </head>
  <body>
    <!-- <button id="test">测试</button> -->
    <div class="live-container">
      <div class="live-content" id="container"></div>
    </div>
    <script>
      const init = async () => {
        const { Application, Container, Graphics, Assets, Sprite } = PIXI;

        // 初始化画布
        const container = document.getElementById("container");
        const app = new Application({
          antialias: true, // 锯齿
          // background: "pink",
          resizeTo: container,
          backgroundAlpha: 0, // 透明度
        });

        container.appendChild(app.view);
        // 注:为使用pixi.js的渲染方式,扑克值的大小反过来使用
        const pokers = [
          { alias: "方块2", number: "2", src: "../image/2-diamond.png" },
          { alias: "黑桃2", number: "2", src: "../image/2-spade.png" },
          { alias: "梅花3", number: "3", src: "../image/3-club.png" },
          { alias: "黑桃3", number: "3", src: "../image/3-spade.png" },
          { alias: "梅花5", number: "5", src: "../image/5-club.png" },
          { alias: "梅花A", number: "15", src: "../image/A-club.png" },
          { alias: "方块A", number: "15", src: "../image/A-diamond.png" },
          { alias: "红桃A", number: "15", src: "../image/A-heart.png" },
          { alias: "黑桃A", number: "15", src: "../image/A-spade.png" },
          { alias: "大王", number: "1", src: "../image/red-joker.png" },
          { alias: "大王", number: "1", src: "../image/red-joker.png" },
          { alias: "方块2", number: "2", src: "../image/2-diamond.png" },
          { alias: "黑桃2", number: "2", src: "../image/2-spade.png" },
          { alias: "梅花3", number: "3", src: "../image/3-club.png" },
          { alias: "黑桃3", number: "3", src: "../image/3-spade.png" },
        ];
        // 两种玩家信息背景
        const groupBack = [
          { alias: "red-team", src: "../image/group2.png" },
          { alias: "green-team", src: "../image/group1.png" },
        ];

        //   创建四位玩家容器
        const containerOne = new Container();
        const containerTwo = new Container();
        const containerThree = new Container();
        const containerFour = new Container();

        // 排序(大牌小牌位置)
        pokers.sort((a, b) => b.number - a.number);

        // 预加载资源
        pokers.forEach((item, index) => {
          // item.number = index + 1
          Assets.add({ alias: item.alias, src: item.src });
        });

        // 将数值相同的牌分组
        const groupedPokers = {};
        for (const poker of pokers) {
          if (!groupedPokers[poker.number]) {
            groupedPokers[poker.number] = [];
          }
          groupedPokers[poker.number].push(poker);
        }

        // 玩家一
        let currentX1 = 0;
        let currentY1 = 0;
        let box1 = new Graphics();
        box1.drawRect(0, 0, 0, 0);

        // 渲染玩家一扑克牌
        createSprite("player1", currentX1, currentY1, box1, groupedPokers);

        // 渲染玩家信息
        const back1 = await loadBackground(groupBack[0]);
        back1.position.set(-back1.width - 10, 0);
        containerOne.addChild(back1);

        containerOne.addChild(box1);
        containerOne.position.set(app.renderer.width / 2 - box1.width, 10);

        // 玩家二
        let currentX2 = 0;
        let currentY2 = 0;
        let box2 = new Graphics();
        box2.drawRect(0, 0, 0, 0);

        // 渲染玩家二扑克牌
        createSprite("player2", currentX2, currentY2, box2, groupedPokers);

        // 渲染玩家信息
        const back2 = await loadBackground(groupBack[1]);
        back2.position.set(0, -back2.height - 10);
        containerTwo.addChild(back2);

        containerTwo.addChild(box2);
        containerTwo.position.set(
          10,
          app.renderer.height / 2 - box2.height / 2
        );

        // 玩家三
        let currentX3 = 0;
        let currentY3 = 0;
        let box3 = new Graphics();
        box3.drawRect(0, 0, 0, 0);

        // 渲染玩家三扑克牌
        createSprite("player3", currentX3, currentY3, box3, groupedPokers);

        // 渲染玩家信息
        const back3 = await loadBackground(groupBack[0]);
        back3.position.set(-back3.width - 10, -back3.height + 20);
        containerThree.addChild(back3);

        containerThree.addChild(box3);
        containerThree.position.set(
          app.renderer.width / 2 - box3.width / 2,
          app.renderer.height - box3.height / 2 - 20
        );

        // 玩家四
        let currentX4 = 0;
        let currentY4 = 0;
        let box4 = new Graphics();
        box4.drawRect(0, 0, 0, 0);

        // 渲染玩家四扑克牌
        createSprite("play4", currentX4, currentY4, box4, groupedPokers);

        // 渲染玩家信息
        const back4 = await loadBackground(groupBack[1]);
        back4.position.set(-back4.width - 10, -back4.height - 10);
        containerFour.addChild(back4);

        containerFour.addChild(box4);
        containerFour.position.set(
          app.renderer.width - box4.width - 10,
          app.renderer.height / 2 - box4.height / 2
        );

        app.stage.addChild(containerOne);
        app.stage.addChild(containerTwo);
        app.stage.addChild(containerThree);
        app.stage.addChild(containerFour);
      };

      init();
    </script>
  </body>
</html>
